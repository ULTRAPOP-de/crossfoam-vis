<!DOCTYPE html>
<head>
<meta charset="utf-8">
</head>
<body>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script>

  const width = 1000;
  const height = 1000;
  const radius = 50;
  const outerRadius = 5;
  const thetaOffset = Math.PI / 2;

  const svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("viewBox", [0, 0, width, height]);


  const g = svg.append("g")
    .attr("transform", `translate(${width/2}, ${height/2})`);

  g.append("circle")
    .attr("r", radius)
    .style("fill", "transparent")
    .style("stroke", "black");

  const line = g.append("line")
    .style("stroke", "black");

  const label = g.append("text")
    .style("font-family", "Helvetica, Arial, sans-serif")
    .style("font-size", "12px")
    .attr("dy", "-4")
    .text("0");

  const rect = g.append("rect")
    .style("fill", "transparent")
    .style("stroke", "black");

  const pX = (r, theta) => {
    return r * Math.cos(theta);
  };

  const pY = (r, theta) => {
    return r * Math.sin(theta);
  };
  
  let percentage = 0;

  const percentageScale = d3.scaleLinear()
    .domain([0,100])
    .range([0, Math.PI * 2]);

  const update = () => {
    percentage++;
    if (percentage > 100) {
      percentage = 0;
    }

    line
      .attr("x1", pX(radius, percentageScale(percentage)-thetaOffset))
      .attr("y1", pY(radius, percentageScale(percentage)-thetaOffset))
      .attr("x2", pX(radius+outerRadius, percentageScale(percentage)-thetaOffset))
      .attr("y2", pY(radius+outerRadius, percentageScale(percentage)-thetaOffset));

    label.text(percentage);
    radialLabel(label, radius+2*outerRadius, percentageScale(percentage));
  };

  const radialLabel = (label, r, theta) => {
    const bbox = label.node().getBBox();
    const domain = [];

    for (let i = 0; i <= 8; i++) {
      domain.push(Math.PI * (0.25 * i));
    }

    const x = d3.scaleLinear()
      .domain(domain)
      .range([-0.5, 0, 0, 0, -0.5, -1, -1, -1, -0.5]);

    const y = d3.scaleLinear()
      .domain(domain)
      .range([0, 0, 0.5, 1, 1, 1, 0.5, 0, 0]);

    label.attr("transform", `translate(${x(theta) * bbox.width + r * Math.cos(theta - thetaOffset)},\
     ${y(theta) * bbox.height + r * Math.sin(theta - thetaOffset)})`);

  };

  const interval = setInterval(update, 50);

</script>
</body>
</html>